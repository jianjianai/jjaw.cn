import{_ as e,r as o,o as c,c as l,b as a,d as s,w as t,a as i,e as p}from"./app-BDxFVNMI.js";const r={},u=a("h1",{id:"truffleapi简介",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#truffleapi简介"},[a("span",null,"truffleApi简介")])],-1),k=a("p",null,"更多资料",-1),d=i(`<p><strong>Truffle</strong> 为与智能合约进行交互提供了<strong>合约</strong>。如果你想了解合约的方法列表，请直接跳转到 API 部分。</p><h2 id="使用方法" tabindex="-1"><a class="header-anchor" href="#使用方法"><span>使用方法</span></a></h2><p>要获取合约，你可以使用 <strong>artifacts</strong> 对象的require函数通过合约名称来引入它。在控制台之外，这迁移文件、测试和执行脚本中的一个对象。你可以按照以下方式引入你的合约：</p><div class="language-javascript" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line"><span class="token keyword">const</span> MyContract <span class="token operator">=</span> artifacts<span class="token punctuation">.</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;MyContract&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre></div><p>控制台中或测试脚本中获取合约。你只需使用 <strong>at</strong>、<strong>deployed</strong> 或 <strong>new</strong> 方法即可：</p><div class="language-javascript" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line"><span class="token keyword">const</span> myContract <span class="token operator">=</span> <span class="token keyword">await</span> MyContract<span class="token punctuation">.</span><span class="token function">deployed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre></div><p>现在你可以访问 <strong>MyContract</strong> 上的以下函数，以及其他许多函数：</p><ul><li><strong>at(address)</strong>：创建一个表示特定地址上的合约的 <strong>MyContract</strong> 实例。</li><li><strong>deployed()</strong>：创建一个表示由 <strong>MyContract</strong> 管理的默认地址的合约实例。</li><li><strong>new()</strong>：部署此合约的新版本到网络，并获取一个表示新部署实例的 <strong>MyContract</strong> 实例。</li></ul><p>每个实例与以太坊网络上的特定地址相关联，且每个实例的 JavaScript 函数与合约函数具有 1 对 1 的映射关系。例如，如果你的 Solidity 合约中定义了一个函数 <code>someFunction(uint value) {}</code>，你可以在网络上执行该函数，如下所示：</p><div class="language-javascript" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line"><span class="token keyword">let</span> deployed<span class="token punctuation">;</span></span>
<span class="line">MyContract<span class="token punctuation">.</span><span class="token function">deployed</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">instance</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    deployed <span class="token operator">=</span> instance<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> deployed<span class="token punctuation">.</span><span class="token function">someFunction</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 处理结果或继续执行更多交易。</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre></div><p>你还可以使用更简洁的 <strong>async/await</strong> 语法：</p><div class="language-javascript" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line"><span class="token keyword">const</span> deployed <span class="token operator">=</span> <span class="token keyword">await</span> MyContract<span class="token punctuation">.</span><span class="token function">deployed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> deployed<span class="token punctuation">.</span><span class="token function">someFunction</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// 处理结果或继续执行更多交易。</span></span>
<span class="line"></span></code></pre></div><p>有关结果对象的详细信息，请参阅“<a href="#%E5%A4%84%E7%90%86%E4%BA%A4%E6%98%93%E7%BB%93%E6%9E%9C">处理交易结果</a>”部分。</p><p>合约方法和事件具有 EventEmitter 接口，因此你可以设置如下的处理程序：</p><div class="language-javascript" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line"><span class="token keyword">const</span> example <span class="token operator">=</span> <span class="token keyword">await</span> artifacts<span class="token punctuation">.</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;Example&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">deployed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">example</span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;transactionHash&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">hash</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;receipt&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">receipt</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;confirmation&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">num<span class="token punctuation">,</span> receipt</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">receipt</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">example</span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">ExampleEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;data&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token operator">...</span> etc <span class="token operator">...</span> <span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">example</span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">ExampleEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">&#39;data&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token operator">...</span> etc <span class="token operator">...</span> <span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><h2 id="api" tabindex="-1"><a class="header-anchor" href="#api"><span>API</span></a></h2><p>常用的API有两个。一个是<strong>合约API</strong>，另一个是<strong>实例API</strong>。<strong>合约API</strong> 是一组适用于所有合约对象的函数，这些函数存在于对象本身上（例如，<code>MyContract.at()</code>）。相比之下，<strong>实例 API</strong> 是可用于合约实例的API，即表示网络上特定合约的实例，该API是基于Solidity源文件中可用的函数动态创建的。</p><h3 id="合约api" tabindex="-1"><a class="header-anchor" href="#合约api"><span>合约API</span></a></h3><p>每个合约对象（例如上面的 MyContract）都具有以下可用的函数：</p><h4 id="mycontract-new-arg1-arg2-tx-params" tabindex="-1"><a class="header-anchor" href="#mycontract-new-arg1-arg2-tx-params"><span><code>MyContract.new([arg1, arg2, ...], [tx params])</code></span></a></h4><p>此函数接受你的合约所需的全部构造函数参数，并在网络上部署一个新的合约实例。在最后还有一个可选的参数，你可以用它来传递交易参数，包括交易发起地址、gas限制和价格。此函数返回一个 Promise，解析为新部署地址处的合约实例。</p><h4 id="mycontract-at-address" tabindex="-1"><a class="header-anchor" href="#mycontract-at-address"><span><code>MyContract.at(address)</code></span></a></h4><p>此函数在指定的地址创建一个表示合约的新合约实例。返回一个“thenable”对象（出于向后兼容性考虑，尚不是实际的 Promise）。在确保代码存在于指定地址后，解析为合约实例。</p><h4 id="mycontract-deployed" tabindex="-1"><a class="header-anchor" href="#mycontract-deployed"><span><code>MyContract.deployed()</code></span></a></h4><p>创建一个表示合约在其部署地址处的合约实例。部署地址是 truffle-contract 分配的特殊值，当设置后，会在内部保存该地址，以便从所使用的以太坊网络中推断出部署地址。这使你可以编写代码，引用特定部署的合约，而无需自行管理这些地址。与 at() 合约似，deployed() 也是 thenable，并将解析为表示已部署合约的合约实例，前提是代码存在于该位置并且该地址在所使用的网络上存在。</p><h4 id="mycontract-link-instance" tabindex="-1"><a class="header-anchor" href="#mycontract-link-instance"><span><code>MyContract.link(instance)</code></span></a></h4><p>将由合约实例表示的库链接到 MyContract。该库必须首先部署并设置其部署地址。名称和部署地址将从合约实例中推断出来。当使用此形式的 <code>MyContract.link()</code> 时，MyContract 将消耗所有链接库的事件，并能够报告这些事件发生在交易结果中。</p><p>可以多次链接库，将覆盖其先前的链接。</p><p>注意：此方法还有其他两种形式，但建议使用此形式。</p><h4 id="mycontract-link-name-address" tabindex="-1"><a class="header-anchor" href="#mycontract-link-name-address"><span><code>MyContract.link(name, address)</code></span></a></h4><p>将具有特定名称和地址的库链接到 MyContract。不会使用此形式消耗库的事件。</p><h4 id="mycontract-link-object" tabindex="-1"><a class="header-anchor" href="#mycontract-link-object"><span><code>MyContract.link(object)</code></span></a></h4><p>将由对象表示的多个库链接到 MyContract。键必须是表示库名称的字符串，值必须是表示地址的字符串。与上述合约似，不会使用此形式消耗库的事件。</p><h4 id="mycontract-networks" tabindex="-1"><a class="header-anchor" href="#mycontract-networks"><span><code>MyContract.networks()</code></span></a></h4><p>查看此合约实例已设置的网络 ID 列表。</p><h4 id="mycontract-setprovider-provider" tabindex="-1"><a class="header-anchor" href="#mycontract-setprovider-provider"><span><code>MyContract.setProvider(provider)</code></span></a></h4><p>设置此合约实例将用于执行交易的 web3 提供程序。</p><h4 id="mycontract-hasnetwork-network-id" tabindex="-1"><a class="header-anchor" href="#mycontract-hasnetwork-network-id"><span><code>MyContract.hasNetwork(network_id)</code></span></a></h4><p>设置 MyContract 当前表示的网络。</p><h4 id="mycontract-hasnetwork-network-id-1" tabindex="-1"><a class="header-anchor" href="#mycontract-hasnetwork-network-id-1"><span><code>MyContract.hasNetwork(network_id)</code></span></a></h4><p>返回一个布尔值，表示此合约实例是否已设置为表示特定网络。</p><p>以下是对你提供的英文文本的中文翻译：</p><h3 id="mycontract-defaults-new-defaults" tabindex="-1"><a class="header-anchor" href="#mycontract-defaults-new-defaults"><span><code>MyContract.defaults([new_defaults])</code></span></a></h3><p>获取并可选择为从此合约创建的所有实例设置交易默认值。如果没有传递任何参数，它将简单地返回一个表示当前默认值的对象。如果传递了一个对象，它将设置新的默认值。可以设置的示例默认交易值包括：</p><div class="language-javascript" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line">MyContract<span class="token punctuation">.</span><span class="token function">defaults</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">from</span><span class="token operator">:</span> <span class="token operator">...</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">gas</span><span class="token operator">:</span> <span class="token operator">...</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">gasPrice</span><span class="token operator">:</span> <span class="token operator">...</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token operator">...</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><p>例如，设置默认的调用者地址在你有一个合约用于表示一个用户（即一个地址）时非常有用。</p><h3 id="mycontract-clone-network-id" tabindex="-1"><a class="header-anchor" href="#mycontract-clone-network-id"><span><code>MyContract.clone(network_id)</code></span></a></h3><p>克隆一个合约，以获取另一个管理相同合约构件的对象，但使用不同的 network_id。如果你想在不同的网络上管理相同的合约，这将非常有用。在使用此函数时，请不要忘记之后设置正确的提供程序。</p><div class="language-javascript" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line"><span class="token keyword">const</span> MyOtherContract <span class="token operator">=</span> MyContract<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token number">1337</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre></div><h3 id="mycontract-numberformat-number-type" tabindex="-1"><a class="header-anchor" href="#mycontract-numberformat-number-type"><span><code>MyContract.numberFormat = number_type</code></span></a></h3><p>你可以设置此属性来选择合约方法返回的数字格式。默认行为是返回 BN。</p><div class="language-javascript" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line"><span class="token comment">// 可选值为：[&quot;BigNumber&quot;, &quot;BN&quot;, &quot;String&quot;]。</span></span>
<span class="line"><span class="token keyword">const</span> Example <span class="token operator">=</span> artifacts<span class="token punctuation">.</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;Example&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">Example<span class="token punctuation">.</span>numberFormat <span class="token operator">=</span> <span class="token string">&#39;BigNumber&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre></div><h3 id="mycontract-timeout-block-timeout" tabindex="-1"><a class="header-anchor" href="#mycontract-timeout-block-timeout"><span><code>MyContract.timeout(block_timeout)</code></span></a></h3><p>此方法允许你设置交易的区块超时时间。从此合约创建的合约实例将具有指定的交易区块超时时间。这意味着如果交易不立即被挖掘，它将在指定的区块数内重试。</p><h3 id="mycontract-autogas-boolean" tabindex="-1"><a class="header-anchor" href="#mycontract-autogas-boolean"><span><code>MyContract.autoGas = &lt;boolean&gt;</code></span></a></h3><p>如果设置为 true，从此合约创建的实例将使用 web3.eth.estimateGas，然后应用gas乘数来确定要包含在交易中的gas量。默认值为 true。请参阅 gasMultiplier。</p><h3 id="mycontract-gasmultiplier-gas-multiplier" tabindex="-1"><a class="header-anchor" href="#mycontract-gasmultiplier-gas-multiplier"><span><code>MyContract.gasMultiplier(gas_multiplier)</code></span></a></h3><p>在启用 <code>autoGas</code> 时用于确定要包含在交易中的gas量的值。gas量的计算是通过使用 <code>web3.eth.estimateGas</code> 并将其乘以gas乘数来完成的。默认值为 1.25。</p><h2 id="实例api" tabindex="-1"><a class="header-anchor" href="#实例api"><span>实例API</span></a></h2><p>根据 Solidity 合约的源代码，每个合约实例都是不同的，并且 API 是动态创建的。为了本文档的目的，让我们使用下面的 Solidity 源代码：</p><div class="language-solidity" data-highlighter="prismjs" data-ext="solidity" data-title="solidity"><pre class="language-solidity"><code><span class="line"><span class="token keyword">contract</span> <span class="token class-name">MyContract</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token builtin">uint</span> <span class="token keyword">public</span> value<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">event</span> <span class="token function">ValueSet</span><span class="token punctuation">(</span><span class="token builtin">uint</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">function</span> <span class="token function">setValue</span><span class="token punctuation">(</span><span class="token builtin">uint</span> val<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    value <span class="token operator">=</span> val<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">emit</span> <span class="token function">ValueSet</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">function</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">constant</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> value<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>从 JavaScript 的角度来看，这个合约有三个函数：<code>setValue</code>、<code>getValue</code> 和 <code>value</code>。这是因为 <code>value</code> 是公共的，并且会自动创建一个 getter 函数。</p><p>这个合约允许你设置和获取一个名为 <code>value</code> 的整数值，并且在设置值时触发一个事件 <code>ValueSet</code>。</p><h3 id="通过交易调用合约函数" tabindex="-1"><a class="header-anchor" href="#通过交易调用合约函数"><span>通过交易调用合约函数</span></a></h3><p>当我们调用 <code>setValue()</code> 时，这会创建一个交易。</p><p>JavaScript 的例子：</p><div class="language-javascript" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line"><span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> instance<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// result 对象包含有关交易的重要信息</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Value was set to&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>logs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>args<span class="token punctuation">.</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre></div><p>返回的结果对象如下所示：</p><div class="language-javascript" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">tx</span><span class="token operator">:</span> <span class="token string">&quot;0x6cb0bbb6466b342ed7bc4a9816f1da8b92db1ccf197c3f91914fc2c721072ebd&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">receipt</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// The return value from web3.eth.getTransactionReceipt(hash)</span></span>
<span class="line">    <span class="token comment">// See https://github.com/ethereum/wiki/wiki/JavaScript-API#web3ethgettransactionreceipt</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">logs</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">{</span> <span class="token literal-property property">logIndex</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">transactionIndex</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">transactionHash</span><span class="token operator">:</span> <span class="token string">&#39;0x728b4d1983cd00d93ae00b7adf76f78c1b32d922de636ead42e93f70cf58cdc9&#39;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">blockHash</span><span class="token operator">:</span> <span class="token string">&#39;0xdce5e6c580267c9bf1d82bf0a167fa60509ef9fc520b8619d8183a8373a42035&#39;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">blockNumber</span><span class="token operator">:</span> <span class="token number">19</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">address</span><span class="token operator">:</span> <span class="token string">&#39;0x035b8A9e427d93D178E2D22d600B779717696831&#39;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;mined&#39;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;log_70be22b0&#39;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">event</span><span class="token operator">:</span> <span class="token string">&#39;Transfer&#39;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">args</span><span class="token operator">:</span></span>
<span class="line">        Result <span class="token punctuation">{</span></span>
<span class="line">          <span class="token string-property property">&#39;0&#39;</span><span class="token operator">:</span> <span class="token string">&#39;0x7FEb9FAA5aED0FD547Ccc70f00C19dDe95ea54d4&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token string-property property">&#39;1&#39;</span><span class="token operator">:</span> <span class="token string">&#39;0x7FEb9FAA5aED0FD547Ccc70f00C19dDe95ea54d4&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token string-property property">&#39;2&#39;</span><span class="token operator">:</span> <span class="token operator">&lt;</span><span class="token constant">BN</span><span class="token operator">:</span> <span class="token number">1</span><span class="token operator">&gt;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">__length__</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">_from</span><span class="token operator">:</span> <span class="token string">&#39;0x7FEb9FAA5aED0FD547Ccc70f00C19dDe95ea54d4&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">_to</span><span class="token operator">:</span> <span class="token string">&#39;0x7FEb9FAA5aED0FD547Ccc70f00C19dDe95ea54d4&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">_value</span><span class="token operator">:</span> <span class="token operator">&lt;</span><span class="token constant">BN</span><span class="token operator">:</span> <span class="token number">1</span><span class="token operator">&gt;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><p>请注意，如果在交易中执行的函数具有返回值，你将无法在此结果中获取该返回值。你必须使用事件（例如 <code>ValueSet</code>）并在日志数组中查找结果。</p><h3 id="在不创建交易的情况下调用" tabindex="-1"><a class="header-anchor" href="#在不创建交易的情况下调用"><span>在不创建交易的情况下调用</span></a></h3><p>我们可以通过显式使用 <code>.call</code> 来调用 <code>setValue()</code>：</p><div class="language-javascript" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line"><span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token keyword">await</span> instance<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre></div><p>然而，在这种情况下，这并不是很有用，因为 <code>setValue()</code> 会修改状态，而我们传递的值不会被保存，因为我们没有创建交易。</p><h3 id="调用getters" tabindex="-1"><a class="header-anchor" href="#调用getters"><span>调用getters</span></a></h3><p>我们可以使用 <code>getValue()</code> 并使用 <code>.call()</code>。调用是免费的，不需要消耗任何以太币，因此适用于读取区块链数据的函数：</p><div class="language-javascript" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line"><span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token keyword">await</span> instance<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// value 表示 Solidity 合约中的 \`value\` 存储对象</span></span>
<span class="line"><span class="token comment">// 因为合约返回了该值。</span></span>
<span class="line"></span></code></pre></div><p>更有帮助的是，当一个函数被标记为 <code>constant</code> 时，我们甚至不需要使用 <code>.call</code>，因为 truffle-contract 会自动知道该函数只能通过调用进行交互：</p><div class="language-javascript" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line"><span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token keyword">await</span> instance<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// val 表示 Solidity 合约中的 \`value\` 存储对象</span></span>
<span class="line"><span class="token comment">// 因为合约返回了该值。</span></span>
<span class="line"></span></code></pre></div><h3 id="处理交易结果" tabindex="-1"><a class="header-anchor" href="#处理交易结果"><span>处理交易结果</span></a></h3><p>当你执行一个交易时，会得到一个<code>result</code>对象，其中包含有关交易的丰富信息。你将获得交易哈希（<code>result.tx</code>）、解码的事件（也称为日志；<code>result.logs</code>）以及交易收据（<code>result.receipt</code>）。在下面的示例中，你将收到 <code>ValueSet()</code> 事件，因为你使用 <code>setValue()</code> 函数触发了该事件：</p><div class="language-javascript" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line"><span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> instance<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// result.tx =&gt; 交易哈希，字符串</span></span>
<span class="line"><span class="token comment">// result.logs =&gt; 触发事件的数组（在此情况下为 1 个项目）</span></span>
<span class="line"><span class="token comment">// result.receipt =&gt; 收据对象</span></span>
<span class="line"></span></code></pre></div><h3 id="发送以太币-触发回退函数" tabindex="-1"><a class="header-anchor" href="#发送以太币-触发回退函数"><span>发送以太币 / 触发回退函数</span></a></h3><p>你可以通过向此函数发送交易来触发回退函数：</p><div class="language-javascript" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line"><span class="token keyword">const</span> result <span class="token operator">=</span> instance<span class="token punctuation">.</span><span class="token function">sendTransaction</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// 与上面的结果对象相同。</span></span>
<span class="line"></span></code></pre></div><p>这是一个合约似于所有可用合约实例函数的 promise 化版本，并且具有与 <code>web3.eth.sendTransaction</code> 相同的 API，但没有回调。<code>to</code> 值将自动填充。</p><p>如果你只想向合约发送以太币，还有一种简写方式：</p><div class="language-javascript" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line"><span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> instance<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>web3<span class="token punctuation">.</span><span class="token function">toWei</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;ether&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// 与上面的结果对象相同。</span></span>
<span class="line"></span></code></pre></div><h3 id="预测gas用量" tabindex="-1"><a class="header-anchor" href="#预测gas用量"><span>预测gas用量</span></a></h3><p>你可以运行以下函数来预测gas使用量：</p><div class="language-javascript" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line"><span class="token keyword">const</span> result <span class="token operator">=</span> instance<span class="token punctuation">.</span>setValue<span class="token punctuation">.</span><span class="token function">estimateGas</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// result =&gt; 预测的gas量</span></span>
<span class="line"></span></code></pre></div>`,91);function g(h,m){const n=o("RouteLink");return c(),l("div",null,[u,k,a("ul",null,[a("li",null,[s(n,{to:"/articles/12-truffle%E6%B5%8B%E8%AF%95/2-truffle%E5%88%9D%E6%AD%A5%E5%85%A5%E9%97%A8.html"},{default:t(()=>[p("truffle初步入门")]),_:1})]),a("li",null,[s(n,{to:"/articles/12-truffle%E6%B5%8B%E8%AF%95/1-truffle%E7%94%A8JavaScript%E5%86%99%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B.html"},{default:t(()=>[p("用JavaScript写测试用例")]),_:1})])]),d])}const f=e(r,[["render",g],["__file","index.html.vue"]]),v=JSON.parse('{"path":"/2024/12/11/truffle-api/","title":"truffleApi 使用简介","lang":"zh-CN","frontmatter":{"permalinkPattern":"2024/12/11/truffle-api/","title":"truffleApi 使用简介","description":"本文简单讲解了truffleApi的使用方法，帮助对于有JavaScript经验的您快速入门。","tags":["后端"],"star":false,"comment":true,"head":[["meta",{"property":"og:url","content":"https://jjaw.cn/2024/12/11/truffle-api/"}],["meta",{"property":"og:site_name","content":"神奇小破站"}],["meta",{"property":"og:title","content":"truffleApi 使用简介"}],["meta",{"property":"og:description","content":"本文简单讲解了truffleApi的使用方法，帮助对于有JavaScript经验的您快速入门。"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-12-11T07:27:23.000Z"}],["meta",{"property":"article:tag","content":"后端"}],["meta",{"property":"article:modified_time","content":"2024-12-11T07:27:23.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"truffleApi 使用简介\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-12-11T07:27:23.000Z\\",\\"author\\":[]}"]]},"headers":[{"level":2,"title":"使用方法","slug":"使用方法","link":"#使用方法","children":[]},{"level":2,"title":"API","slug":"api","link":"#api","children":[{"level":3,"title":"合约API","slug":"合约api","link":"#合约api","children":[]},{"level":3,"title":"MyContract.defaults([new_defaults])","slug":"mycontract-defaults-new-defaults","link":"#mycontract-defaults-new-defaults","children":[]},{"level":3,"title":"MyContract.clone(network_id)","slug":"mycontract-clone-network-id","link":"#mycontract-clone-network-id","children":[]},{"level":3,"title":"MyContract.numberFormat = number_type","slug":"mycontract-numberformat-number-type","link":"#mycontract-numberformat-number-type","children":[]},{"level":3,"title":"MyContract.timeout(block_timeout)","slug":"mycontract-timeout-block-timeout","link":"#mycontract-timeout-block-timeout","children":[]},{"level":3,"title":"MyContract.autoGas = <boolean>","slug":"mycontract-autogas-boolean","link":"#mycontract-autogas-boolean","children":[]},{"level":3,"title":"MyContract.gasMultiplier(gas_multiplier)","slug":"mycontract-gasmultiplier-gas-multiplier","link":"#mycontract-gasmultiplier-gas-multiplier","children":[]}]},{"level":2,"title":"实例API","slug":"实例api","link":"#实例api","children":[{"level":3,"title":"通过交易调用合约函数","slug":"通过交易调用合约函数","link":"#通过交易调用合约函数","children":[]},{"level":3,"title":"在不创建交易的情况下调用","slug":"在不创建交易的情况下调用","link":"#在不创建交易的情况下调用","children":[]},{"level":3,"title":"调用getters","slug":"调用getters","link":"#调用getters","children":[]},{"level":3,"title":"处理交易结果","slug":"处理交易结果","link":"#处理交易结果","children":[]},{"level":3,"title":"发送以太币 / 触发回退函数","slug":"发送以太币-触发回退函数","link":"#发送以太币-触发回退函数","children":[]},{"level":3,"title":"预测gas用量","slug":"预测gas用量","link":"#预测gas用量","children":[]}]}],"git":{"isRoot":true,"createdTime":1733902043000,"updatedTime":1733902043000,"contributors":[{"name":"jjaw","email":"jjaw@jjaw.cn","commits":1}]},"excerpt":"\\n<p>更多资料</p>\\n<ul>\\n<li><a href=\\"/articles/12-truffle%E6%B5%8B%E8%AF%95/2-truffle%E5%88%9D%E6%AD%A5%E5%85%A5%E9%97%A8.html\\" target=\\"_blank\\">truffle初步入门</a></li>\\n<li><a href=\\"/articles/12-truffle%E6%B5%8B%E8%AF%95/1-truffle%E7%94%A8JavaScript%E5%86%99%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B.html\\" target=\\"_blank\\">用JavaScript写测试用例</a></li>\\n</ul>","github_edit":{"fileGitUrl":"https://github.com/jianjianai/jjaw.cn/edit/master/articles/12-truffle测试/0-truffleApi简介.md"},"navPage":[{"title":"truffleApi 使用简介","link":"/2024/12/11/truffle-api/"},{"title":"truffle 测试用例简单讲解","link":"/2024/12/11/truffle-test-start/"},{"title":"truffle 详细快速入门","link":"/2024/12/11/truffle-beginner/"},{"title":"常用 assertApi","link":"/2024/12/11/truffle-assert/"},{"title":"常用 web3Api","link":"/2024/12/11/truffle-web3-api/"}]}');export{f as comp,v as data};
